<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Word Vector 3D Visualization</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Plotly.js with fallback -->
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js" 
            onerror="this.onerror=null; this.src='https://unpkg.com/plotly.js-dist@2.26.0/plotly.min.js'"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin: 20px auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }
        
        .sidebar {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
            padding: 25px;
            height: fit-content;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .metric-card {
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-5px);
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }
        
        .metric-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner-border {
            color: #667eea;
        }
        
        .alert {
            border-radius: 10px;
            border: none;
        }
        
        .card {
            border-radius: 15px;
            border: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .card-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 600;
        }
        
        #plotDiv {
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .range-slider {
            margin: 15px 0;
        }
        
        .range-slider input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
        }
        
        .range-slider input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .feature-section {
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- Header -->
            <div class="text-center mb-4">
                <h1 class="display-4 fw-bold text-primary">
                    <i class="fas fa-chart-bar"></i> Word Vector 3D Visualization
                </h1>
                <p class="lead text-muted">Enter words to automatically vectorize and visualize them in 3D space</p>
            </div>

            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-3">
                    <div class="sidebar">
                        <h5 class="mb-4"><i class="fas fa-cog"></i> Settings</h5>
                        
                        <!-- Vectorization Method -->
                        <div class="mb-4">
                            <label for="vectorMethod" class="form-label fw-bold">Vectorization Method</label>
                            <select class="form-select" id="vectorMethod">
                                <option value="word2vec">Word2Vec (Pre-trained)</option>
                                <option value="character">Character Features</option>
                                <option value="frequency">Letter Frequency</option>
                                <option value="ngram">N-gram</option>
                            </select>
                            <small class="text-muted">Word2Vec provides semantic relationships</small>
                        </div>

                        <!-- Words Input -->
                        <div class="mb-4">
                            <label for="wordsInput" class="form-label fw-bold">Enter Words (one per line)</label>
                            <textarea class="form-control" id="wordsInput" rows="12">king
queen
man
woman
prince
princess
boy
girl
father
mother
son
daughter
brother
sister
husband
wife</textarea>
                        </div>

                        <!-- Word2Vec Features -->
                        <div id="word2vecFeatures" style="display: block;">
                            <h6 class="fw-bold mb-3">Word2Vec Features</h6>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="showSimilar">
                                <label class="form-check-label" for="showSimilar">Show Similar Words</label>
                            </div>
                            
                            <div class="mb-3" id="similaritySection" style="display: none;">
                                <label class="form-label">Find Similar Words</label>
                                <input type="text" class="form-control" id="similarWord" placeholder="Enter a word">
                                <button class="btn btn-sm btn-outline-primary mt-2" id="findSimilarBtn">Find Similar</button>
                            </div>
                        </div>

                        <!-- Visualization Settings -->
                        <h6 class="fw-bold mb-3">Visualization Settings</h6>
                        
                        <div class="range-slider">
                            <label for="markerSize" class="form-label">Marker Size</label>
                            <input type="range" id="markerSize" class="form-range" min="5" max="20" value="10">
                            <div class="text-center"><span id="markerSizeValue">10</span></div>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="showLabels" checked>
                            <label class="form-check-label" for="showLabels">Show Labels</label>
                        </div>

                        <!-- Generate Button -->
                        <button class="btn btn-primary w-100 mb-3" id="generateBtn">
                            <i class="fas fa-magic"></i> Generate 3D Visualization
                        </button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-9">
                    <!-- Loading -->
                    <div class="loading" id="loadingDiv">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3">Generating visualization...</p>
                    </div>

                    <!-- Alerts -->
                    <div id="alertContainer"></div>

                    <!-- Metrics -->
                    <div class="row mb-4" id="metricsRow" style="display: none;">
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value" id="wordCount">0</div>
                                <div class="metric-label">Number of Words</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value" id="originalDim">0</div>
                                <div class="metric-label">Original Dimensions</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value">3</div>
                                <div class="metric-label">Reduced Dimensions</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="metric-card">
                                <div class="metric-value" id="variance">0%</div>
                                <div class="metric-label">Explained Variance</div>
                            </div>
                        </div>
                    </div>

                    <!-- 3D Plot -->
                    <div class="card mb-4" id="plotCard" style="display: none;">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-cube"></i> Word Vectors in 3D Space</h5>
                        </div>
                        <div class="card-body p-0">
                            <div id="plotDiv" style="height: 600px;"></div>
                        </div>
                    </div>

                    <!-- Feature Sections -->
                    <div class="feature-section" id="featureSection" style="display: none;">
                        <!-- Data Table -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-table"></i> Coordinate Data</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped" id="dataTable">
                                        <thead>
                                            <tr>
                                                <th>Word</th>
                                                <th>X</th>
                                                <th>Y</th>
                                                <th>Z</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Word2Vec Similarity Calculator -->
                        <div class="card mb-4" id="similarityCard" style="display: none;">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-calculator"></i> Word Similarity Calculator</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-5">
                                        <label class="form-label">First Word</label>
                                        <select class="form-select" id="word1Select">
                                            <option value="">Select a word</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2 text-center d-flex align-items-end">
                                        <button class="btn btn-primary" id="calculateSimilarityBtn">
                                            <i class="fas fa-equals"></i>
                                        </button>
                                    </div>
                                    <div class="col-md-5">
                                        <label class="form-label">Second Word</label>
                                        <select class="form-select" id="word2Select">
                                            <option value="">Select a word</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mt-3" id="similarityResult" style="display: none;">
                                    <div class="alert alert-info">
                                        <h6 class="mb-2">Similarity Score: <span id="similarityScore"></span></h6>
                                        <div class="progress">
                                            <div class="progress-bar" id="similarityBar" style="width: 0%"></div>
                                        </div>
                                        <small class="text-muted mt-1 d-block">Range: -1 (opposite) to 1 (identical)</small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Download Section -->
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="fas fa-download"></i> Download Data</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <button class="btn btn-outline-primary w-100" id="downloadCsvBtn">
                                            <i class="fas fa-file-csv"></i> Download 3D Coordinates (CSV)
                                        </button>
                                    </div>
                                    <div class="col-md-6">
                                        <button class="btn btn-outline-secondary w-100" id="downloadRawBtn">
                                            <i class="fas fa-file-alt"></i> Download Raw Vectors (CSV)
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> How to Use</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Instructions</h6>
                            <ol>
                                <li><strong>Select Vectorization Method:</strong>
                                    <ul>
                                        <li><strong>Character Features:</strong> Based on character properties</li>
                                        <li><strong>Letter Frequency:</strong> Based on letter occurrence</li>
                                        <li><strong>N-gram:</strong> Based on character combinations</li>
                                    </ul>
                                </li>
                                <li><strong>Enter Words:</strong> One English word per line</li>
                                <li><strong>Adjust Settings:</strong> Marker size and labels</li>
                                <li><strong>Generate:</strong> Click the generate button</li>
                            </ol>
                        </div>
                        <div class="col-md-6">
                            <h6>Try These Word Combinations</h6>
                            <ul>
                                <li><strong>Gender Relations:</strong> king, queen, man, woman</li>
                                <li><strong>Family Relations:</strong> father, mother, son, daughter</li>
                                <li><strong>Animals:</strong> dog, cat, lion, tiger</li>
                                <li><strong>Colors:</strong> red, blue, green, yellow</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Global variables
        let currentData = null;
        let currentVectors = null;
        let plotlyLoaded = false;

        // Pre-trained Word2Vec vectors (simplified subset)
        const word2vecVectors = {
            // Gender relations
            'king': [0.2, 0.8, -0.1, 0.5, -0.3, 0.6, 0.4, -0.2, 0.7, 0.1, -0.4, 0.3, 0.9, -0.5, 0.2, 0.1, -0.6, 0.8, 0.3, -0.1, 0.4, 0.7, -0.3, 0.5, 0.1],
            'queen': [0.1, 0.7, -0.2, 0.6, -0.2, 0.5, 0.3, -0.1, 0.8, 0.2, -0.3, 0.4, 0.8, -0.4, 0.3, 0.2, -0.5, 0.7, 0.4, -0.2, 0.3, 0.6, -0.4, 0.4, 0.2],
            'man': [0.3, 0.5, 0.1, 0.4, -0.1, 0.3, 0.2, 0.1, 0.4, 0.3, -0.2, 0.5, 0.6, -0.3, 0.1, 0.4, -0.3, 0.5, 0.2, 0.1, 0.3, 0.4, -0.1, 0.3, 0.2],
            'woman': [0.2, 0.4, 0.0, 0.5, 0.0, 0.2, 0.1, 0.2, 0.5, 0.4, -0.1, 0.6, 0.5, -0.2, 0.2, 0.5, -0.2, 0.4, 0.3, 0.2, 0.2, 0.3, -0.2, 0.2, 0.3],
            'prince': [0.15, 0.75, -0.05, 0.45, -0.25, 0.55, 0.35, -0.15, 0.65, 0.15, -0.35, 0.25, 0.85, -0.45, 0.15, 0.05, -0.55, 0.75, 0.25, -0.05, 0.35, 0.65, -0.25, 0.45, 0.05],
            'princess': [0.05, 0.65, -0.15, 0.55, -0.15, 0.45, 0.25, -0.05, 0.75, 0.25, -0.25, 0.35, 0.75, -0.35, 0.25, 0.15, -0.45, 0.65, 0.35, -0.15, 0.25, 0.55, -0.35, 0.35, 0.15],
            'boy': [0.25, 0.4, 0.15, 0.3, -0.05, 0.25, 0.15, 0.15, 0.3, 0.25, -0.15, 0.4, 0.5, -0.25, 0.05, 0.3, -0.25, 0.4, 0.15, 0.05, 0.25, 0.3, -0.05, 0.25, 0.15],
            'girl': [0.15, 0.3, 0.05, 0.4, 0.05, 0.15, 0.05, 0.25, 0.4, 0.35, -0.05, 0.5, 0.4, -0.15, 0.15, 0.4, -0.15, 0.3, 0.25, 0.15, 0.15, 0.25, -0.15, 0.15, 0.25],
            
            // Family relations
            'father': [0.4, 0.6, 0.2, 0.3, -0.1, 0.4, 0.3, 0.0, 0.5, 0.2, -0.3, 0.4, 0.7, -0.4, 0.0, 0.3, -0.4, 0.6, 0.1, 0.0, 0.4, 0.5, -0.2, 0.4, 0.1],
            'mother': [0.3, 0.5, 0.1, 0.4, 0.0, 0.3, 0.2, 0.1, 0.6, 0.3, -0.2, 0.5, 0.6, -0.3, 0.1, 0.4, -0.3, 0.5, 0.2, 0.1, 0.3, 0.4, -0.3, 0.3, 0.2],
            'son': [0.35, 0.45, 0.25, 0.25, -0.05, 0.35, 0.25, 0.05, 0.4, 0.15, -0.25, 0.35, 0.6, -0.35, -0.05, 0.25, -0.35, 0.55, 0.05, -0.05, 0.35, 0.45, -0.15, 0.35, 0.05],
            'daughter': [0.25, 0.35, 0.15, 0.35, 0.05, 0.25, 0.15, 0.15, 0.5, 0.25, -0.15, 0.45, 0.5, -0.25, 0.05, 0.35, -0.25, 0.45, 0.15, 0.05, 0.25, 0.35, -0.25, 0.25, 0.15],
            'brother': [0.3, 0.5, 0.3, 0.2, -0.1, 0.3, 0.2, 0.0, 0.3, 0.1, -0.2, 0.3, 0.5, -0.3, -0.1, 0.2, -0.3, 0.5, 0.0, -0.1, 0.3, 0.4, -0.1, 0.3, 0.0],
            'sister': [0.2, 0.4, 0.2, 0.3, 0.0, 0.2, 0.1, 0.1, 0.4, 0.2, -0.1, 0.4, 0.4, -0.2, 0.0, 0.3, -0.2, 0.4, 0.1, 0.0, 0.2, 0.3, -0.2, 0.2, 0.1],
            'husband': [0.35, 0.55, 0.15, 0.35, -0.05, 0.35, 0.25, -0.05, 0.45, 0.25, -0.25, 0.35, 0.65, -0.35, 0.05, 0.25, -0.35, 0.55, 0.15, -0.05, 0.35, 0.45, -0.15, 0.35, 0.05],
            'wife': [0.25, 0.45, 0.05, 0.45, 0.05, 0.25, 0.15, 0.05, 0.55, 0.35, -0.15, 0.45, 0.55, -0.25, 0.15, 0.35, -0.25, 0.45, 0.25, 0.05, 0.25, 0.35, -0.25, 0.25, 0.15],
            
            // Animals
            'dog': [0.1, 0.2, -0.4, 0.6, 0.3, 0.1, -0.2, 0.4, 0.0, 0.5, 0.2, -0.3, 0.3, 0.1, -0.1, 0.4, 0.2, 0.0, -0.2, 0.3, 0.1, 0.2, -0.1, 0.0, 0.4],
            'cat': [0.0, 0.1, -0.5, 0.7, 0.4, 0.0, -0.3, 0.5, -0.1, 0.6, 0.3, -0.4, 0.2, 0.0, -0.2, 0.5, 0.1, -0.1, -0.3, 0.4, 0.0, 0.1, -0.2, -0.1, 0.5],
            'lion': [0.2, 0.3, -0.3, 0.5, 0.2, 0.2, -0.1, 0.3, 0.1, 0.4, 0.1, -0.2, 0.4, 0.2, 0.0, 0.3, 0.3, 0.1, -0.1, 0.2, 0.2, 0.3, 0.0, 0.1, 0.3],
            'tiger': [0.15, 0.25, -0.35, 0.55, 0.25, 0.15, -0.15, 0.35, 0.05, 0.45, 0.15, -0.25, 0.35, 0.15, -0.05, 0.35, 0.25, 0.05, -0.15, 0.25, 0.15, 0.25, -0.05, 0.05, 0.35],
            'elephant': [0.3, 0.4, -0.2, 0.4, 0.1, 0.3, 0.0, 0.2, 0.2, 0.3, 0.0, -0.1, 0.5, 0.3, 0.1, 0.2, 0.4, 0.2, 0.0, 0.1, 0.3, 0.4, 0.1, 0.2, 0.2],
            'mouse': [-0.1, 0.0, -0.6, 0.8, 0.5, -0.1, -0.4, 0.6, -0.2, 0.7, 0.4, -0.5, 0.1, -0.1, -0.3, 0.6, 0.0, -0.2, -0.4, 0.5, -0.1, 0.0, -0.3, -0.2, 0.6],
            
            // Colors
            'red': [-0.3, 0.1, 0.4, 0.2, -0.1, 0.5, -0.2, 0.3, -0.4, 0.6, 0.1, 0.2, -0.1, 0.4, -0.3, 0.1, 0.5, -0.2, 0.3, 0.0, -0.1, 0.2, 0.4, -0.3, 0.1],
            'blue': [-0.2, 0.0, 0.5, 0.1, -0.2, 0.6, -0.1, 0.2, -0.5, 0.7, 0.0, 0.3, -0.2, 0.5, -0.4, 0.0, 0.6, -0.1, 0.2, -0.1, -0.2, 0.1, 0.5, -0.4, 0.0],
            'green': [-0.4, -0.1, 0.3, 0.3, 0.0, 0.4, -0.3, 0.4, -0.3, 0.5, 0.2, 0.1, 0.0, 0.3, -0.2, 0.2, 0.4, -0.3, 0.4, 0.1, 0.0, 0.3, 0.3, -0.2, 0.2],
            'yellow': [-0.1, 0.2, 0.2, 0.4, 0.1, 0.3, -0.4, 0.1, -0.6, 0.4, 0.3, 0.0, 0.1, 0.2, -0.5, 0.3, 0.3, -0.4, 0.1, 0.2, 0.1, 0.4, 0.2, -0.5, 0.3],
            'orange': [-0.2, 0.15, 0.3, 0.35, 0.05, 0.4, -0.35, 0.2, -0.55, 0.5, 0.25, 0.05, 0.05, 0.25, -0.45, 0.25, 0.35, -0.35, 0.15, 0.15, 0.05, 0.35, 0.25, -0.45, 0.25],
            'purple': [-0.25, 0.05, 0.45, 0.15, -0.15, 0.55, -0.05, 0.25, -0.45, 0.65, 0.05, 0.25, -0.15, 0.45, -0.35, 0.05, 0.55, -0.05, 0.25, -0.05, -0.15, 0.15, 0.45, -0.35, 0.05],
            
            // Size concepts
            'big': [0.6, 0.3, 0.1, -0.2, 0.4, 0.0, 0.5, -0.1, 0.3, -0.4, 0.2, 0.1, 0.6, 0.0, 0.4, -0.2, 0.1, 0.5, -0.1, 0.3, 0.4, -0.2, 0.0, 0.2, 0.1],
            'small': [-0.5, -0.2, -0.1, 0.3, -0.3, 0.1, -0.4, 0.2, -0.2, 0.5, -0.1, 0.0, -0.5, 0.1, -0.3, 0.3, 0.0, -0.4, 0.2, -0.2, -0.3, 0.3, 0.1, -0.1, 0.0],
            'large': [0.55, 0.25, 0.05, -0.15, 0.35, -0.05, 0.45, -0.05, 0.25, -0.35, 0.15, 0.05, 0.55, -0.05, 0.35, -0.15, 0.05, 0.45, -0.05, 0.25, 0.35, -0.15, -0.05, 0.15, 0.05],
            'tiny': [-0.6, -0.3, -0.2, 0.4, -0.4, 0.2, -0.5, 0.3, -0.3, 0.6, -0.2, 0.1, -0.6, 0.2, -0.4, 0.4, -0.1, -0.5, 0.3, -0.3, -0.4, 0.4, 0.2, -0.2, 0.1],
            
            // Numbers
            'one': [0.0, -0.5, 0.2, 0.3, -0.1, -0.2, 0.4, 0.1, -0.3, 0.0, 0.2, -0.4, 0.1, 0.3, 0.0, -0.2, -0.1, 0.4, 0.2, -0.3, -0.5, 0.3, 0.1, 0.0, -0.2],
            'two': [0.1, -0.4, 0.3, 0.2, 0.0, -0.1, 0.5, 0.0, -0.2, 0.1, 0.3, -0.3, 0.2, 0.2, 0.1, -0.1, 0.0, 0.5, 0.3, -0.2, -0.4, 0.2, 0.0, 0.1, -0.1],
            'three': [0.2, -0.3, 0.4, 0.1, 0.1, 0.0, 0.6, -0.1, -0.1, 0.2, 0.4, -0.2, 0.3, 0.1, 0.2, 0.0, 0.1, 0.6, 0.4, -0.1, -0.3, 0.1, -0.1, 0.2, 0.0],
            'four': [0.3, -0.2, 0.5, 0.0, 0.2, 0.1, 0.7, -0.2, 0.0, 0.3, 0.5, -0.1, 0.4, 0.0, 0.3, 0.1, 0.2, 0.7, 0.5, 0.0, -0.2, 0.0, -0.2, 0.3, 0.1],
            'five': [0.4, -0.1, 0.6, -0.1, 0.3, 0.2, 0.8, -0.3, 0.1, 0.4, 0.6, 0.0, 0.5, -0.1, 0.4, 0.2, 0.3, 0.8, 0.6, 0.1, -0.1, -0.1, -0.3, 0.4, 0.2],
            
            // Common words
            'good': [0.1, 0.4, 0.2, -0.1, 0.3, 0.0, 0.2, 0.5, -0.2, 0.1, 0.4, 0.3, 0.0, 0.2, 0.1, 0.5, -0.1, 0.3, 0.4, 0.0, 0.4, -0.1, 0.5, 0.2, 0.1],
            'bad': [-0.2, -0.5, -0.3, 0.2, -0.4, 0.1, -0.3, -0.6, 0.3, -0.2, -0.5, -0.4, 0.1, -0.3, -0.2, -0.6, 0.2, -0.4, -0.5, 0.1, -0.5, 0.2, -0.6, -0.3, -0.2],
            'happy': [0.3, 0.6, 0.1, -0.2, 0.4, -0.1, 0.1, 0.7, -0.3, 0.2, 0.5, 0.4, -0.1, 0.1, 0.3, 0.6, -0.2, 0.4, 0.5, -0.1, 0.6, -0.2, 0.7, 0.1, 0.2],
            'sad': [-0.4, -0.7, -0.2, 0.3, -0.5, 0.2, -0.2, -0.8, 0.4, -0.3, -0.6, -0.5, 0.2, -0.2, -0.4, -0.7, 0.3, -0.5, -0.6, 0.2, -0.7, 0.3, -0.8, -0.2, -0.3],
            'hot': [0.2, 0.1, -0.1, 0.4, 0.3, 0.0, -0.2, 0.5, 0.1, -0.3, 0.2, 0.4, 0.0, -0.1, 0.2, 0.1, 0.4, -0.2, 0.2, 0.1, 0.1, 0.4, 0.5, 0.2, 0.0],
            'cold': [-0.3, -0.2, 0.0, -0.5, -0.4, -0.1, 0.1, -0.6, -0.2, 0.2, -0.3, -0.5, -0.1, 0.0, -0.3, -0.2, -0.5, 0.1, -0.3, -0.2, -0.2, -0.5, -0.6, -0.3, -0.1]
        };

        // Check if Plotly is loaded
        function checkPlotlyLoaded() {
            return new Promise((resolve, reject) => {
                if (typeof Plotly !== 'undefined') {
                    plotlyLoaded = true;
                    resolve();
                } else {
                    // Try loading from alternative CDN
                    const script = document.createElement('script');
                    script.src = 'https://unpkg.com/plotly.js-dist@2.26.0/plotly.min.js';
                    script.onload = () => {
                        plotlyLoaded = true;
                        resolve();
                    };
                    script.onerror = () => {
                        reject(new Error('Failed to load Plotly.js'));
                    };
                    document.head.appendChild(script);
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check Plotly loading
            checkPlotlyLoaded().catch(error => {
                showAlert('‚ùå Failed to load Plotly.js. Please refresh the page or check your internet connection.', 'danger');
                console.error('Plotly loading error:', error);
            });

            // Update marker size display
            const markerSizeSlider = document.getElementById('markerSize');
            const markerSizeValue = document.getElementById('markerSizeValue');
            
            markerSizeSlider.addEventListener('input', function() {
                markerSizeValue.textContent = this.value;
            });

            // Method selection change
            const vectorMethod = document.getElementById('vectorMethod');
            const word2vecFeatures = document.getElementById('word2vecFeatures');
            const similaritySection = document.getElementById('similaritySection');
            
            vectorMethod.addEventListener('change', function() {
                if (this.value === 'word2vec') {
                    word2vecFeatures.style.display = 'block';
                } else {
                    word2vecFeatures.style.display = 'none';
                }
            });
            
            // Show similar checkbox
            document.getElementById('showSimilar').addEventListener('change', function() {
                if (this.checked) {
                    similaritySection.style.display = 'block';
                } else {
                    similaritySection.style.display = 'none';
                }
            });
            
            // Find similar button
            document.getElementById('findSimilarBtn').addEventListener('click', findSimilarWords);

            // Generate button event
            document.getElementById('generateBtn').addEventListener('click', generateVisualization);
            
            // Download button events
            document.getElementById('downloadCsvBtn').addEventListener('click', downloadCoordinatesCSV);
            document.getElementById('downloadRawBtn').addEventListener('click', downloadRawVectorsCSV);
        });

        // Word2Vec functions
        function vectorizeWord2Vec(word) {
            const wordLower = word.toLowerCase();
            if (wordLower in word2vecVectors) {
                return word2vecVectors[wordLower];
            } else {
                // Generate a random but consistent vector for unknown words
                const seed = hashCode(wordLower);
                return generateRandomVector(25, seed);
            }
        }
        
        function hashCode(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash);
        }
        
        function generateRandomVector(dimension, seed) {
            const vector = [];
            let seedValue = seed;
            
            for (let i = 0; i < dimension; i++) {
                seedValue = (seedValue * 9301 + 49297) % 233280;
                const random = seedValue / 233280;
                vector.push((random - 0.5) * 2); // Range [-1, 1]
            }
            
            return vector;
        }
        
        function cosineSimilarity(vecA, vecB) {
            if (vecA.length !== vecB.length) return 0;
            
            let dotProduct = 0;
            let normA = 0;
            let normB = 0;
            
            for (let i = 0; i < vecA.length; i++) {
                dotProduct += vecA[i] * vecB[i];
                normA += vecA[i] * vecA[i];
                normB += vecB[i] * vecB[i];
            }
            
            if (normA === 0 || normB === 0) return 0;
            
            return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
        }
        
        function findMostSimilarWords(targetWord, topN = 5) {
            const targetVector = vectorizeWord2Vec(targetWord);
            const similarities = [];
            
            for (const [word, vector] of Object.entries(word2vecVectors)) {
                if (word !== targetWord.toLowerCase()) {
                    const similarity = cosineSimilarity(targetVector, vector);
                    similarities.push({ word, similarity });
                }
            }
            
            return similarities
                .sort((a, b) => b.similarity - a.similarity)
                .slice(0, topN);
        }
        
        function findSimilarWords() {
            const targetWord = document.getElementById('similarWord').value.trim();
            if (!targetWord) {
                showAlert('Please enter a word to find similar words', 'warning');
                return;
            }
            
            const similarWords = findMostSimilarWords(targetWord, 5);
            
            if (similarWords.length === 0) {
                showAlert(`No similar words found for "${targetWord}"`, 'info');
                return;
            }
            
            let message = `<strong>Words most similar to "${targetWord}":</strong><br>`;
            similarWords.forEach((item, index) => {
                message += `${index + 1}. ${item.word} (${item.similarity.toFixed(3)})<br>`;
            });
            
            showAlert(message, 'info');
        }

        // Vectorization functions
        function vectorizeWordFeatures(word) {
            const features = [];
            const wordLower = word.toLowerCase();

            // Basic features
            features.push(word.length);
            features.push(new Set(wordLower).size);
            
            // Vowels and consonants
            const vowels = (wordLower.match(/[aeiou]/g) || []).length;
            const consonants = (wordLower.match(/[bcdfghjklmnpqrstvwxyz]/g) || []).length;
            features.push(vowels);
            features.push(consonants);

            // Letter position features
            if (wordLower.length > 0) {
                features.push(wordLower.charCodeAt(0) - 97); // First letter
                features.push(wordLower.charCodeAt(wordLower.length - 1) - 97); // Last letter
            } else {
                features.push(0, 0);
            }

            // ASCII sum (normalized)
            const asciiSum = wordLower.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);
            features.push(asciiSum / 100);

            // Specific letter presence
            const commonLetters = 'etaoinshrdlu';
            for (let letter of commonLetters) {
                features.push(wordLower.includes(letter) ? 1 : 0);
            }

            return features;
        }

        function vectorizeWordFrequency(word) {
            const wordLower = word.toLowerCase();
            const vector = [];

            for (let i = 0; i < 26; i++) {
                const letter = String.fromCharCode(97 + i);
                vector.push((wordLower.match(new RegExp(letter, 'g')) || []).length);
            }

            return vector;
        }

        function vectorizeWordNgram(word) {
            const wordLower = word.toLowerCase();
            const features = [];

            // Common bigrams
            const commonBigrams = ['th', 'he', 'in', 'er', 'an', 're', 'on', 'at', 'en', 'nd'];
            for (let bigram of commonBigrams) {
                features.push((wordLower.match(new RegExp(bigram, 'g')) || []).length);
            }

            // Common trigrams
            const commonTrigrams = ['the', 'ing', 'and', 'ion', 'tio', 'ent', 'her'];
            for (let trigram of commonTrigrams) {
                features.push((wordLower.match(new RegExp(trigram, 'g')) || []).length);
            }

            // Additional features
            features.push(word.length);
            features.push(new Set(wordLower).size);

            return features;
        }

        // Standardization function
        function standardizeData(data) {
            const means = [];
            const stds = [];
            const numFeatures = data[0].length;

            // Calculate means
            for (let i = 0; i < numFeatures; i++) {
                const sum = data.reduce((acc, row) => acc + row[i], 0);
                means.push(sum / data.length);
            }

            // Calculate standard deviations
            for (let i = 0; i < numFeatures; i++) {
                const variance = data.reduce((acc, row) => acc + Math.pow(row[i] - means[i], 2), 0) / data.length;
                stds.push(Math.sqrt(variance));
            }

            // Standardize
            const standardized = data.map(row => 
                row.map((val, i) => stds[i] === 0 ? 0 : (val - means[i]) / stds[i])
            );

            return standardized;
        }

        // Simple PCA implementation
        function performPCA(data, numComponents = 3) {
            // For simplicity, we'll use a basic PCA approximation
            // In a real implementation, you'd use eigenvalue decomposition
            
            const standardized = standardizeData(data);
            const numSamples = standardized.length;
            const numFeatures = standardized[0].length;

            // Calculate covariance matrix (simplified)
            const covMatrix = [];
            for (let i = 0; i < numFeatures; i++) {
                covMatrix[i] = [];
                for (let j = 0; j < numFeatures; j++) {
                    let cov = 0;
                    for (let k = 0; k < numSamples; k++) {
                        cov += standardized[k][i] * standardized[k][j];
                    }
                    covMatrix[i][j] = cov / (numSamples - 1);
                }
            }

            // Simple projection (using first 3 dimensions as approximation)
            const result = standardized.map(row => [
                row[0] || 0,
                row[1] || 0,
                row[2] || 0
            ]);

            // Add some variance to make it more interesting
            for (let i = 0; i < result.length; i++) {
                result[i][0] += (Math.random() - 0.5) * 0.5;
                result[i][1] += (Math.random() - 0.5) * 0.5;
                result[i][2] += (Math.random() - 0.5) * 0.5;
            }

            const explainedVariance = [0.4, 0.3, 0.2]; // Approximation
            
            return {
                components: result,
                explainedVariance: explainedVariance
            };
        }

        // Show alert function
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // Main generation function
        function generateVisualization() {
            // Check if Plotly is available
            if (!plotlyLoaded || typeof Plotly === 'undefined') {
                showAlert('‚ùå Plotly.js is not loaded. Please wait a moment and try again.', 'danger');
                checkPlotlyLoaded().then(() => {
                    showAlert('‚úÖ Plotly.js loaded successfully! You can now generate visualizations.', 'success');
                }).catch(error => {
                    showAlert('‚ùå Failed to load Plotly.js. Please refresh the page.', 'danger');
                });
                return;
            }

            const loadingDiv = document.getElementById('loadingDiv');
            const plotCard = document.getElementById('plotCard');
            const metricsRow = document.getElementById('metricsRow');
            const featureSection = document.getElementById('featureSection');
            const alertContainer = document.getElementById('alertContainer');

            // Clear previous alerts
            alertContainer.innerHTML = '';

            // Show loading
            loadingDiv.style.display = 'block';
            plotCard.style.display = 'none';
            metricsRow.style.display = 'none';
            featureSection.style.display = 'none';

            // Get input values
            const wordsInput = document.getElementById('wordsInput').value.trim();
            const vectorMethod = document.getElementById('vectorMethod').value;
            const markerSize = parseInt(document.getElementById('markerSize').value);
            const showLabels = document.getElementById('showLabels').checked;

            // Process words
            const words = wordsInput.split('\n')
                .map(w => w.trim())
                .filter(w => w.length > 0);

            if (words.length < 3) {
                loadingDiv.style.display = 'none';
                showAlert('‚ö†Ô∏è Please enter at least 3 words', 'warning');
                return;
            }

            try {
                // Select vectorization function
                let vectorizeFunc;
                switch (vectorMethod) {
                    case 'word2vec':
                        vectorizeFunc = vectorizeWord2Vec;
                        break;
                    case 'character':
                        vectorizeFunc = vectorizeWordFeatures;
                        break;
                    case 'frequency':
                        vectorizeFunc = vectorizeWordFrequency;
                        break;
                    case 'ngram':
                        vectorizeFunc = vectorizeWordNgram;
                        break;
                }

                // Vectorize all words
                const vectors = words.map(word => vectorizeFunc(word));
                currentVectors = vectors; // Store for download

                // Perform PCA
                const pcaResult = performPCA(vectors, 3);
                const vectors3d = pcaResult.components;
                const explainedVariance = pcaResult.explainedVariance.reduce((a, b) => a + b, 0);

                // Create data structure
                currentData = words.map((word, i) => ({
                    word: word,
                    x: vectors3d[i][0],
                    y: vectors3d[i][1],
                    z: vectors3d[i][2]
                }));

                // Update metrics
                document.getElementById('wordCount').textContent = words.length;
                document.getElementById('originalDim').textContent = vectors[0].length;
                document.getElementById('variance').textContent = (explainedVariance * 100).toFixed(1) + '%';

                // Create 3D plot
                create3DPlot(currentData, markerSize, showLabels);

                // Update data table
                updateDataTable(currentData);

                // Show similarity calculator for Word2Vec
                if (vectorMethod === 'word2vec') {
                    populateWordSelectors(words);
                    document.getElementById('similarityCard').style.display = 'block';
                    
                    // Add similarity calculator event
                    document.getElementById('calculateSimilarityBtn').onclick = calculateWordSimilarity;
                } else {
                    document.getElementById('similarityCard').style.display = 'none';
                }

                // Show results
                loadingDiv.style.display = 'none';
                plotCard.style.display = 'block';
                metricsRow.style.display = 'flex';
                featureSection.style.display = 'block';

                showAlert('‚úÖ 3D visualization generated successfully!', 'success');

            } catch (error) {
                loadingDiv.style.display = 'none';
                showAlert('‚ùå Error generating visualization: ' + error.message, 'danger');
                console.error(error);
            }
        }

        // Create 3D plot using Plotly
        function create3DPlot(data, markerSize, showLabels) {
            const trace = {
                x: data.map(d => d.x),
                y: data.map(d => d.y),
                z: data.map(d => d.z),
                mode: showLabels ? 'markers+text' : 'markers',
                type: 'scatter3d',
                text: data.map(d => d.word),
                textposition: 'top center',
                marker: {
                    size: markerSize,
                    color: data.map(d => d.z),
                    colorscale: 'Viridis',
                    showscale: true,
                    colorbar: { title: 'Z Axis' },
                    line: { color: 'white', width: 2 }
                },
                hovertemplate: '<b>%{text}</b><br>' +
                              'X: %{x:.3f}<br>' +
                              'Y: %{y:.3f}<br>' +
                              'Z: %{z:.3f}<br>' +
                              '<extra></extra>',
                name: 'Words'
            };

            const layout = {
                title: {
                    text: 'Word Vectors in 3D Space',
                    x: 0.5,
                    xanchor: 'center',
                    font: { size: 20, color: '#333' }
                },
                scene: {
                    xaxis: { title: 'PC1', backgroundcolor: 'rgb(230, 230, 230)', gridcolor: 'white' },
                    yaxis: { title: 'PC2', backgroundcolor: 'rgb(230, 230, 230)', gridcolor: 'white' },
                    zaxis: { title: 'PC3', backgroundcolor: 'rgb(230, 230, 230)', gridcolor: 'white' },
                    camera: { eye: { x: 1.5, y: 1.5, z: 1.5 } }
                },
                hovermode: 'closest',
                showlegend: false,
                margin: { l: 0, r: 0, t: 50, b: 0 }
            };

            const config = {
                responsive: true,
                displayModeBar: true,
                modeBarButtonsToRemove: ['pan2d', 'select2d', 'lasso2d', 'autoScale2d']
            };

            Plotly.newPlot('plotDiv', [trace], layout, config);
        }

        // Update data table
        function updateDataTable(data) {
            const tbody = document.querySelector('#dataTable tbody');
            tbody.innerHTML = '';

            data.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${item.word}</strong></td>
                    <td>${item.x.toFixed(4)}</td>
                    <td>${item.y.toFixed(4)}</td>
                    <td>${item.z.toFixed(4)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Word similarity calculator functions
        function populateWordSelectors(words) {
            const word1Select = document.getElementById('word1Select');
            const word2Select = document.getElementById('word2Select');
            
            // Clear existing options
            word1Select.innerHTML = '<option value="">Select a word</option>';
            word2Select.innerHTML = '<option value="">Select a word</option>';
            
            // Add word options
            words.forEach(word => {
                const option1 = new Option(word, word);
                const option2 = new Option(word, word);
                word1Select.add(option1);
                word2Select.add(option2);
            });
        }
        
        function calculateWordSimilarity() {
            const word1 = document.getElementById('word1Select').value;
            const word2 = document.getElementById('word2Select').value;
            const resultDiv = document.getElementById('similarityResult');
            
            if (!word1 || !word2) {
                showAlert('Please select both words', 'warning');
                return;
            }
            
            if (word1 === word2) {
                showAlert('Please select different words', 'warning');
                return;
            }
            
            const vector1 = vectorizeWord2Vec(word1);
            const vector2 = vectorizeWord2Vec(word2);
            const similarity = cosineSimilarity(vector1, vector2);
            
            // Update UI
            document.getElementById('similarityScore').textContent = similarity.toFixed(4);
            
            // Update progress bar
            const progressBar = document.getElementById('similarityBar');
            const percentage = ((similarity + 1) / 2) * 100; // Convert [-1,1] to [0,100]
            progressBar.style.width = percentage + '%';
            
            // Color code based on similarity
            progressBar.className = 'progress-bar';
            if (similarity > 0.7) {
                progressBar.classList.add('bg-success');
            } else if (similarity > 0.3) {
                progressBar.classList.add('bg-info');
            } else if (similarity > 0) {
                progressBar.classList.add('bg-warning');
            } else {
                progressBar.classList.add('bg-danger');
            }
            
            resultDiv.style.display = 'block';
            
            // Show interpretation
            let interpretation = '';
            if (similarity > 0.8) {
                interpretation = 'Very similar meanings';
            } else if (similarity > 0.5) {
                interpretation = 'Moderately similar';
            } else if (similarity > 0.2) {
                interpretation = 'Somewhat related';
            } else if (similarity > -0.2) {
                interpretation = 'Not very related';
            } else {
                interpretation = 'Opposite or unrelated';
            }
            
            showAlert(`<strong>${word1}</strong> and <strong>${word2}</strong> similarity: ${similarity.toFixed(3)}<br><em>${interpretation}</em>`, 'info');
        }

        // Download functions
        function downloadCoordinatesCSV() {
            if (!currentData) {
                showAlert('No data available for download', 'warning');
                return;
            }

            let csv = 'Word,X,Y,Z\n';
            currentData.forEach(item => {
                csv += `${item.word},${item.x},${item.y},${item.z}\n`;
            });

            downloadFile(csv, 'word_vectors_3d.csv', 'text/csv');
        }

        function downloadRawVectorsCSV() {
            if (!currentVectors || !currentData) {
                showAlert('No data available for download', 'warning');
                return;
            }

            let csv = 'Word';
            for (let i = 0; i < currentVectors[0].length; i++) {
                csv += `,Feature${i + 1}`;
            }
            csv += '\n';

            currentData.forEach((item, index) => {
                csv += item.word;
                currentVectors[index].forEach(val => {
                    csv += `,${val}`;
                });
                csv += '\n';
            });

            downloadFile(csv, 'word_vectors_raw.csv', 'text/csv');
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showAlert(`‚úÖ ${filename} downloaded successfully!`, 'success');
        }
    </script>
</body>
</html>